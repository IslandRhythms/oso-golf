<div class="px-2 py-1">
  <div class="text-4xl font-bold tracking-tight sm:text-6xl mb-0.5 flex gap-2">
    <div>
      <img class="h-[1em]" src="https://ui.osohq.com/logo-bear-black.png">
    </div>
    <div>
      Oso Golf
    </div>
  </div>
  <div class="mb-4">
    Read the Oso policy below, and then add Oso facts to satisfy the given constraints as fast as you can!
  </div>
  <div v-show="state.level === 0">
    <div>
      <label for="name" class="block text-sm font-medium leading-6 text-gray-900">Your Name</label>
      <div class="mt-2">
        <input type="name" name="name" id="name" v-model="state.name" class="block w-full rounded-md border-0 py-1.5 pl-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6" placeholder="John Smith">
      </div>
      <p class="mt-2 text-sm text-red-600" id="name-error" v-if="state.errors.name">{{state.errors.name}}</p>
    </div>
    <div class="mt-3">
      <label for="email" class="block text-sm font-medium leading-6 text-gray-900">Email</label>
      <div class="mt-2">
        <input type="email" name="email" id="email" v-model="state.email" class="block w-full rounded-md border-0 py-1.5 pl-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6" placeholder="you@example.com">
      </div>
      <p class="mt-2 text-sm text-red-600" id="email-error" v-if="state.errors.email">{{state.errors.email}}</p>
    </div>
    <async-button
      class="rounded-md bg-green-600 px-3.5 py-2.5 mt-6 text-sm font-semibold text-white shadow-sm hover:bg-green-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-green-600"
      @click="startGame()">
      Start Game
    </async-button>
    <div class="mt-3">
      <async-button
        class="rounded-md bg-yellow-600 px-3.5 py-2.5 mt-6 text-sm font-semibold text-white shadow-sm hover:bg-yellow-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-yellow-600"
        @click="$router.push('/leaderboard')">
        View Leaderboard
      </async-button>
    </div>
  </div>
  <div v-show="state.level > 0 && state.level < levels.length + 1">
    <div class="flex gap-10 mb-3">
      <div><b>Hole:</b> {{state.level}} / 2</div>
      <div><b>Par Total:</b> {{par}}</div>
      <div class="grow shrink basis-0"><b>Time Elapsed:</b> {{elapsedTime}}</div>
      <div style="width: 60%; padding-left: 1.5rem">
        <async-button @click="restart" class="rounded bg-orange-600 px-2 py-1 text-xl font-semibold text-white shadow-sm hover:bg-orange-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-orange-600">
          Start Over
        </async-button>
      </div>
    </div>
    <div class="flex gap-10">
      <div class="w-[40%] h-[80vh]">
        <div class="text-2xl font-bold leading-9 tracking-tight mt-1" v-if="level">
          Oso Policy
        </div>
        <pre><code class="language-javascript" v-text="polarCode" ref="codeSnippet"></code></pre>
      </div>
      <div class="w-[60%]">
        <div class="text-2xl font-bold leading-9 tracking-tight mt-1" v-if="level">
          Hole {{state.level}} (Par {{level.par}})
        </div>
        <div>
          {{level?.description}}
        </div>
        <div>
          <div class="text-xl font-bold leading-9 tracking-tight mt-1">Constraints</div>
          <div v-for="(constraint, index) in state.constraints">
            <img class="inline w-[24px]" v-show="displayImageForTestResult(index)" :src="displayImageForTestResult(index)">
            {{constraint.userId}} {{constraint.shouldFail ? 'cannot' : 'can'}} {{constraint.action}} {{constraint.resourceType}} {{constraint.resourceId}}
          </div>
          <div class="text-sm text-gray-500 mt-1">
            {{testsInProgress ? 'Tests running on Oso Cloud...' : 'Tests ran successfully on Oso Cloud'}}
          </div>
        </div>
        <div class="w-full mt-3">
          <div class="text-xl font-bold leading-9 tracking-tight mt-1 flex w-full">
            <div class="mr-4">
              Strokes
            </div>
          </div>

          <div class="mt-3">
            <div v-for="fact in state.facts">
              <div v-if="fact.factType === 'role'">
                User {{fact.userId}} has role {{fact.role}} on {{fact.resourceType}} {{fact.resourceId}}
                &nbsp;&nbsp;<async-button @click="deleteFact(fact)" class="rounded bg-red-600 px-2 py-1 text-xs font-semibold text-white shadow-sm hover:bg-red-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">Delete Fact</async-button>
              </div>
              <div v-else>
                Repository {{fact.resourceId}} has attribute {{fact.attribute}} set to {{fact.attributeValue}}
                &nbsp;&nbsp;<async-button @click="deleteFact(fact)" class="rounded bg-red-600 px-2 py-1 text-xs font-semibold text-white shadow-sm hover:bg-red-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">Delete Fact</async-button>
              </div>
            </div>
            <div v-if="status === 'loaded' && state.facts.length === 0">
              No strokes yet! Add some below.
            </div>
          </div>
          
          <div class="bg-gray-50 shadow sm:rounded-lg mt-3">
            <div class="px-4 py-5 sm:p-6">
              <div v-show="level?.showAddRoleFact">
                <div class="font-bold leading-9 tracking-tight mt-1">
                  Add Role
                </div>
                User
                <select
                  v-model="userId"
                  class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 p-1 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
                  <option v-for="user in allUsers" :value="user" v-text="user" />
                </select>
                has role
                <select
                  v-model="roleFact.role"
                  class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 p-1 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
                  <option v-for="role in allRoles" :value="role" v-text="role" />
                </select>
                on resource
                <select
                  v-model="roleFact.resourceType"
                  class="mr-1 bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 p-1 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
                  <option
                    v-for="resource in allResources"
                    :value="resource"
                    v-text="resource" />
                </select>
                <select
                  v-model="roleFact.resourceId"
                  class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 p-1 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
                  <option v-for="resource in resourceIds" :value="resource" v-text="resource" />
                </select>
                <async-button
                  @click="addRoleFact"
                  class="ml-1 rounded bg-indigo-600 px-2 py-1 font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">
                  Add Role
                </async-button>
              </div>

              <div v-show="level?.showAddAttributeFact">
                <div class="font-bold leading-9 tracking-tight mt-3">
                  Add Attribute
                </div>
                Repository
                <select
                  v-model="attributeFact.resourceId"
                  class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 p-1 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
                  <option v-for="resource in state.repositories"
                    :value="resource"
                    v-text="resource" />
                </select>
                has attribute
                <select
                  v-model="attributeFact.attribute"
                  class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 p-1 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
                  <option
                    v-for="attr in allAttributes"
                    :value="attr"
                    v-text="attr" />
                </select>
                set to
                <select
                  v-model="attributeFact.attributeValue"
                  class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 p-1 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
                  <option v-for="v in [true, false]" :value="v" v-text="v" />
                </select>
                <async-button
                  @click="addAttributeFact"
                  class="ml-1 rounded bg-indigo-600 px-2 py-1 font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">
                Add Attribute
                </async-button>
              </div>
            </div>
          </div>
        </div>
        <div class="mt-3" v-if="state.showNextLevelButton">
          <div class="text-xl font-bold leading-9 tracking-tight mt-1 flex w-full">
            <div class="mr-4">
              Solution Found!
            </div>
          </div>
          <div>
            <b>Par:</b> {{parForLevel}}&nbsp;
            <div
              class="inline inline-flex items-center rounded-md bg-green-50 px-2 py-1 text-xs font-medium text-green-700 ring-1 ring-inset ring-green-600/20"
              v-if="parForLevel === -2">
              Eagle
            </div>
            <div
              class="inline inline-flex items-center rounded-md bg-green-50 px-2 py-1 text-xs font-medium text-green-700 ring-1 ring-inset ring-green-600/20"
              v-if="parForLevel === -1">
              Birdie
            </div>
            <div
              class="inline inline-flex items-center rounded-md bg-blue-50 px-2 py-1 text-xs font-medium text-green-700 ring-1 ring-inset ring-blue-700/10"
              v-if="+parForLevel === 0">
              Par
            </div>
            <div
              class="inline inline-flex items-center rounded-md bg-yellow-50 px-2 py-1 text-xs font-medium text-green-700 ring-1 ring-inset ring-yellow-600/20"
              v-if="+parForLevel > 0">
              Over
            </div>
          </div>
          <async-button @click="verifySolutionForLevel" class="mt-3 rounded bg-green-600 px-2 py-1 text-xl font-semibold text-white shadow-sm hover:bg-green-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-green-600">
            Next Level
          </async-button>
        </div>
      </div>
    </div>
  </div>
  <div v-show="state.level >= levels.length + 1">
    <div class="text-2xl font-bold leading-9 tracking-tight">
      You completed the game!
    </div>
    <div>
      Congratulations! Check out where you placed on the <router-link to="/leaderboard" class="text-sky-700">leaderboard</router-link>.
    </div>
    <div>
      <async-button @click="restart" class="rounded bg-orange-600 px-2 py-1 text-xl font-semibold text-white shadow-sm hover:bg-orange-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-orange-600">
        Start Over
      </async-button>
    </div>
  </div>
</div>