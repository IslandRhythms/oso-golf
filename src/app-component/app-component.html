<div class="px-2 py-1">
  <div class="text-4xl font-bold tracking-tight sm:text-6xl mb-0.5">GitClub Golf</div>
  <div class="mb-4">
    Find the minimum number of Oso facts to satisfy the following constraints as fast as you can!
  </div>
  <div v-show="state.level === 0">
    <div>
      <label for="name" class="block text-sm font-medium leading-6 text-gray-900">Your Name</label>
      <div class="mt-2">
        <input type="name" name="name" id="name" v-model="state.name" class="block w-full rounded-md border-0 py-1.5 pl-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6" placeholder="John Smith">
      </div>
      <p class="mt-2 text-sm text-red-600" id="name-error" v-if="state.errors.name">{{state.errors.name}}</p>
    </div>
    <div class="mt-3">
      <label for="email" class="block text-sm font-medium leading-6 text-gray-900">Email</label>
      <div class="mt-2">
        <input type="email" name="email" id="email" v-model="state.email" class="block w-full rounded-md border-0 py-1.5 pl-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6" placeholder="you@example.com">
      </div>
      <p class="mt-2 text-sm text-red-600" id="email-error" v-if="state.errors.email">{{state.errors.email}}</p>
    </div>
    <async-button
      class="rounded-md bg-green-600 px-3.5 py-2.5 mt-6 text-sm font-semibold text-white shadow-sm hover:bg-green-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-green-600"
      @click="startGame()">
      Start Game
    </async-button>
    <div class="mt-3">
      <async-button
        class="rounded-md bg-yellow-600 px-3.5 py-2.5 mt-6 text-sm font-semibold text-white shadow-sm hover:bg-yellow-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-yellow-600"
        @click="$router.push('/leaderboard')">
        View Leaderboard
      </async-button>
    </div>
  </div>
  <div v-show="state.level === 1 || state.level === 2">
    <div class="flex gap-10 mb-3">
      <div><b>Levels Completed:</b> {{state.level - 1}} / 2</div>
      <div><b>Par:</b> {{par}}</div>
      <div><b>Time Elapsed:</b> {{elapsedTime}}</div>
    </div>
    <div class="flex gap-10">
      <div class="w-[40%] h-[80vh]">
        <pre><code class="language-javascript" v-text="polarCode" ref="codeSnippet"></code></pre>
      </div>
      <div class="w-[60%]">
        <div>
          <div class="text-2xl font-bold leading-9 tracking-tight mt-1">Constraints</div>
          <div v-for="constraint in state.constraints">
            {{constraint.userId}} {{constraint.shouldFail ? 'cannot' : 'can'}} {{constraint.action}} {{constraint.resourceType}} {{constraint.resourceId}}
          </div>
        </div>
        <div class="w-full mt-3">
          <div class="text-2xl font-bold leading-9 tracking-tight mt-1 flex w-full">
            <div class="mr-4">
              Add Fact
            </div>
            <div>
              <a
                href="#"
                class="rounded-md px-1.5 py-1"
                @click="factType = 'role'; resourceType = null;"
                :class="factType === 'role' ? 'bg-gray-100 text-gray-700' : 'text-gray-500 hover:text-gray-700'">
                Role
              </a>
              <a
                href="#"
                class="rounded-md px-3 py-2"
                @click="factType = 'attribute'; resourceType = 'Repository';"
                :class="factType === 'attribute' ? 'bg-gray-100 text-gray-700' : 'text-gray-500 hover:text-gray-700'">
                Attribute
              </a>
            </div>
          </div>
          
          <div class="mt-3" v-if="factType === 'role'">
            User <select v-model="userId"><option v-for="user in allUsers" :value="user" v-text="user" /></select>
            has role <select v-model="role"><option v-for="role in allRoles" :value="role" v-text="role" /></select>
            on resource <select v-model="resourceType"><option v-for="resource in allResources" :value="resource" v-text="resource" /></select>
            <select v-model="resourceId"><option v-for="resource in resourceIds" :value="resource" v-text="resource" /></select>
          </div>
          <div class="mt-3" v-if="factType === 'attribute'">
            Repository
            <select v-model="resourceId"><option v-for="resource in resourceIds" :value="resource" v-text="resource" /></select>
            has attribute <select v-model="attribute"><option v-for="attr in allAttributes" :value="attr" v-text="attr" /></select>
            set to <select v-model="attributeValue"><option v-for="v in [true, false]" :value="v" v-text="v" /></select>
          </div>
          <div class="mt-1">
            <async-button
              @click="tell"
              class="rounded bg-indigo-600 px-2 py-1 text-xs font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">
            Add Fact
            </async-button>
          </div>
        </div>
        <div class="mt-3">
          <div class="text-2xl font-bold leading-9 tracking-tight mt-1">Existing Facts</div>
          <div v-for="fact in state.facts">
            <div v-if="fact.factType === 'role'">
              User {{fact.userId}} has role {{fact.role}} on {{fact.resourceType}} {{fact.resourceId}}
              &nbsp;&nbsp;<async-button @click="deleteFact(fact)" class="rounded bg-red-600 px-2 py-1 text-xs font-semibold text-white shadow-sm hover:bg-red-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">Delete Fact</async-button>
            </div>
            <div v-else>
              Repository {{fact.resourceId}} has attribute {{fact.attribute}} set to {{fact.attributeValue}}
              &nbsp;&nbsp;<async-button @click="deleteFact(fact)" class="rounded bg-red-600 px-2 py-1 text-xs font-semibold text-white shadow-sm hover:bg-red-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">Delete Fact</async-button>
            </div>
          </div>
        </div>
        <div class="mt-3">
          <div class="text-2xl font-bold leading-9 tracking-tight mt-1">Test</div>
          <div>
            <async-button
              @click="test"
              class="rounded bg-indigo-600 px-2 py-1 text-xs font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">
              Run Tests
            </async-button>
          </div>
          <div v-for="result in state.results">
            [{{result.pass ? 'PASS' : 'FAIL'}}] {{result.userId}} {{result.shouldFail ? 'cannot' : 'can'}} {{result.action}} {{result.resourceType}} {{result.resourceId}}
          </div>
          <div v-if="state.showNextLevelButton" class="mt-3">
            <async-button @click="verifySolutionForLevel" class="rounded bg-green-600 px-2 py-1 text-xl font-semibold text-white shadow-sm hover:bg-green-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-green-600">
              Next Level
            </async-button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div v-show="state.level === 3">
    <div class="text-2xl font-bold leading-9 tracking-tight">
      You completed the game!
    </div>
    <div>
      Congratulations! Check out where you placed on the <router-link to="/leaderboard" class="text-sky-700">leaderboard</router-link>.
    </div>
    <div>
      <async-button @click="restart" class="rounded bg-orange-600 px-2 py-1 text-xl font-semibold text-white shadow-sm hover:bg-orange-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-orange-600">
        Start Over
      </async-button>
    </div>
  </div>
</div>